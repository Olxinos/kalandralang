<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Kalandralang User Manual</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="style.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Kalandralang User Manual</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#getting-started" id="toc-getting-started">Getting
Started</a>
<ul>
<li><a href="#installation" id="toc-installation">Installation</a>
<ul>
<li><a href="#compile" id="toc-compile">Compile</a></li>
<li><a href="#setup-a-working-directory"
id="toc-setup-a-working-directory">Setup a Working Directory</a></li>
</ul></li>
<li><a href="#usage" id="toc-usage">Usage</a>
<ul>
<li><a href="#command-line-help" id="toc-command-line-help">Command-Line
Help</a></li>
<li><a href="#running-a-recipe" id="toc-running-a-recipe">Running a
Recipe</a></li>
<li><a href="#finding-identifiers" id="toc-finding-identifiers">Finding
Identifiers</a>
<ul>
<li><a href="#using-the-find-command"
id="toc-using-the-find-command">Using the Find Command</a></li>
<li><a href="#using-the-show-mod-pool-instruction"
id="toc-using-the-show-mod-pool-instruction">Using the Show Mod Pool
Instruction</a></li>
</ul></li>
<li><a href="#generate-cost-data" id="toc-generate-cost-data">Generate
Cost Data</a>
<ul>
<li><a href="#from-poeninja" id="toc-from-poeninja">From
poe.ninja</a></li>
<li><a href="#with-default-values" id="toc-with-default-values">With
Default Values</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#example-recipe" id="toc-example-recipe">Example Recipe</a>
<ul>
<li><a href="#code" id="toc-code">Code</a></li>
<li><a href="#run-once" id="toc-run-once">Run Once</a></li>
<li><a href="#run-100-times" id="toc-run-100-times">Run 100
Times</a></li>
</ul></li>
<li><a href="#costs" id="toc-costs">Costs</a></li>
<li><a href="#language-reference" id="toc-language-reference">Language
Reference</a>
<ul>
<li><a href="#general-syntax-rules"
id="toc-general-syntax-rules">General Syntax Rules</a>
<ul>
<li><a href="#comments" id="toc-comments">Comments</a></li>
<li><a href="#keywords" id="toc-keywords">Keywords</a></li>
<li><a href="#numbers" id="toc-numbers">Numbers</a></li>
<li><a href="#identifiers" id="toc-identifiers">Identifiers</a></li>
<li><a href="#variables-and-functions"
id="toc-variables-and-functions">Variables and functions</a></li>
<li><a href="#labels" id="toc-labels">Labels</a></li>
<li><a href="#symbols" id="toc-symbols">Symbols</a></li>
<li><a href="#whitespace" id="toc-whitespace">Whitespace</a></li>
</ul></li>
<li><a href="#computational-model"
id="toc-computational-model">Computational Model</a>
<ul>
<li><a href="#program-point" id="toc-program-point">Program
Point</a></li>
<li><a href="#current-item" id="toc-current-item">Current Item</a></li>
<li><a href="#set-aside-item" id="toc-set-aside-item">Set-Aside
Item</a></li>
<li><a href="#current-imprint" id="toc-current-imprint">Current
Imprint</a></li>
<li><a href="#spendings-and-gains"
id="toc-spendings-and-gains">Spendings and Gains</a></li>
<li><a href="#errors" id="toc-errors">Errors</a></li>
</ul></li>
<li><a href="#buying-a-base" id="toc-buying-a-base">Buying a
Base</a></li>
<li><a href="#crafting-instructions"
id="toc-crafting-instructions">Crafting Instructions</a>
<ul>
<li><a href="#currencies" id="toc-currencies">Currencies</a>
<ul>
<li><a href="#basic-currencies" id="toc-basic-currencies">Basic
Currencies</a></li>
<li><a href="#conqueror-exalted-orbs"
id="toc-conqueror-exalted-orbs">Conqueror Exalted Orbs</a></li>
<li><a href="#eldritch-currencies" id="toc-eldritch-currencies">Eldritch
Currencies</a></li>
<li><a href="#betrayal-currencies" id="toc-betrayal-currencies">Betrayal
Currencies</a></li>
<li><a href="#awakeners-orb" id="toc-awakeners-orb">Awakener's
Orb</a></li>
</ul></li>
<li><a href="#essences" id="toc-essences">Essences</a></li>
<li><a href="#fossils" id="toc-fossils">Fossils</a></li>
<li><a href="#crafting-bench" id="toc-crafting-bench">Crafting Bench</a>
<ul>
<li><a href="#built-ins" id="toc-built-ins">Built-Ins</a></li>
<li><a href="#other-modifiers" id="toc-other-modifiers">Other
Modifiers</a></li>
</ul></li>
<li><a href="#harvest-crafting" id="toc-harvest-crafting">Harvest
Crafting</a></li>
<li><a href="#beastcrafting" id="toc-beastcrafting">Beastcrafting</a>
<ul>
<li><a href="#split" id="toc-split">Split</a></li>
<li><a href="#imprint" id="toc-imprint">Imprint</a></li>
</ul></li>
<li><a href="#betrayal-crafting" id="toc-betrayal-crafting">Betrayal
Crafting</a></li>
<li><a href="#set-aside" id="toc-set-aside">Set Aside</a></li>
<li><a href="#swap" id="toc-swap">Swap</a></li>
<li><a href="#use-imprint" id="toc-use-imprint">Use Imprint</a></li>
</ul></li>
<li><a href="#control-flow-instructions"
id="toc-control-flow-instructions">Control-Flow Instructions</a>
<ul>
<li><a href="#blocks" id="toc-blocks">Blocks</a></li>
<li><a href="#nesting-complex-instructions"
id="toc-nesting-complex-instructions">Nesting Complex
Instructions</a></li>
<li><a href="#label-definitions" id="toc-label-definitions">Label
Definitions</a></li>
<li><a href="#goto" id="toc-goto">Goto</a></li>
<li><a href="#stop" id="toc-stop">Stop</a></li>
<li><a href="#if-conditionals" id="toc-if-conditionals">If
Conditionals</a></li>
<li><a href="#loops" id="toc-loops">Loops</a>
<ul>
<li><a href="#while-loops" id="toc-while-loops">While Loops</a></li>
<li><a href="#until-loops" id="toc-until-loops">Until Loops</a></li>
<li><a href="#repeat-loops" id="toc-repeat-loops">Repeat Loops</a></li>
</ul></li>
</ul></li>
<li><a href="#selling" id="toc-selling">Selling</a></li>
<li><a href="#other-instructions" id="toc-other-instructions">Other
Instructions</a>
<ul>
<li><a href="#echo" id="toc-echo">Echo</a></li>
<li><a href="#show" id="toc-show">Show</a></li>
<li><a href="#show-mod-pool" id="toc-show-mod-pool">Show Mod
Pool</a></li>
</ul></li>
<li><a href="#amounts" id="toc-amounts">Amounts</a></li>
<li><a href="#conditions" id="toc-conditions">Conditions</a>
<ul>
<li><a href="#constants" id="toc-constants">Constants</a></li>
<li><a href="#boolean-operators" id="toc-boolean-operators">Boolean
Operators</a></li>
<li><a href="#parentheses" id="toc-parentheses">Parentheses</a></li>
<li><a href="#predicates-on-current-item"
id="toc-predicates-on-current-item">Predicates on Current Item</a></li>
</ul></li>
<li><a href="#integral-expressions"
id="toc-integral-expressions">Integral expressions</a>
<ul>
<li><a href="#variables" id="toc-variables">Variables</a></li>
<li><a href="#queries-on-current-item"
id="toc-queries-on-current-item">Queries on current item</a></li>
</ul></li>
<li><a href="#functions" id="toc-functions">Functions</a>
<ul>
<li><a href="#declaration" id="toc-declaration">Declaration</a></li>
<li><a href="#function-invocation" id="toc-function-invocation">Function
invocation</a></li>
<li><a href="#return" id="toc-return">Return</a></li>
<li><a href="#side-effects" id="toc-side-effects">Side-effects</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<h2 id="getting-started">Getting Started</h2>
<p>These instructions assume you are using Linux. If you want to use
Kalandralang on Windows, you can have a look at <a
href="https://fdopen.github.io/opam-repository-mingw/">https://fdopen.github.io/opam-repository-mingw/</a>
but you're on your own.</p>
<h3 id="installation">Installation</h3>
<h4 id="compile">Compile</h4>
<p>Install <a href="http://opam.ocaml.org/">opam</a>. Create an Opam
switch if you didn't already, with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">opam</span> switch create 4.13.1</span></code></pre></div>
<p>Clone Kalandralang:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/doomeer/kalandralang</span></code></pre></div>
<p>Ask Opam to build and install Kalandralang:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">opam</span> install kalandralang</span></code></pre></div>
<p>This puts the executable in
<code>~/.opam/4.13.1/bin/kalandralang</code>, so if you have
<code>~/.opam/4.13.1/bin</code> in your <code>PATH</code> (which is the
case if you told the opam installer to update your config files and if
you restarted your terminal), you can run Kalandralang with:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kalandralang</span></span></code></pre></div>
<p>If this doesn't work, try running this instead:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~/.opam/4.13.1/bin/kalandralang</span></span></code></pre></div>
<p>If this works but <code>kalandralang</code> doesn't, it means that
you need to fix your <code>PATH</code>.</p>
<h4 id="setup-a-working-directory">Setup a Working Directory</h4>
<p>Kalandralang requires data files from the <a
href="https://github.com/brather1ng/RePoE">RePoE</a> project to run.
Those data files contain the list of base items, modifiers etc.
Kalandralang looks for those files in a <code>data</code> subdirectory
of the current directory.</p>
<p>First, create a directory for Kalandralang somewhere and
<code>cd</code> into it, for instance:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ~/kalandralang-recipes</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/kalandralang-recipes</span></code></pre></div>
<p>Then, create the <code>data</code> subdirectory and download data
files into it:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> data</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> data</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://raw.githubusercontent.com/brather1ng/RePoE/master/RePoE/data/base_items.json</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://raw.githubusercontent.com/brather1ng/RePoE/master/RePoE/data/mods.json</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://raw.githubusercontent.com/brather1ng/RePoE/master/RePoE/data/stat_translations.json</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://raw.githubusercontent.com/brather1ng/RePoE/master/RePoE/data/essences.json</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ..</span></code></pre></div>
<p>You can now put your recipes in <code>~/kalandralang-recipes</code>
if you want. You can put them somewhere else, but since Kalandralang
must be ran from this directory to find data files, it will make it
easier for you.</p>
<p>Note that the first time Kalandralang reads the data files (e.g. the
first time you run a recipe), it will create a file named
<code>kalandralang.cache</code> with the same data but in binary format
instead of JSON. Using this makes Kalandralang load faster. Once you
have this cache, you can delete the JSON files in the <code>data</code>
directory if you want.</p>
<h3 id="usage">Usage</h3>
<h4 id="command-line-help">Command-Line Help</h4>
<p>Run Kalandralang with <code>--help</code> for documentation of
command-line parameters:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kalandralang</span> <span class="at">--help</span></span></code></pre></div>
<p>You can request help for a given subcommand, such as <code>run</code>
or <code>find</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kalandralang</span> run <span class="at">--help</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kalandralang</span> find <span class="at">--help</span></span></code></pre></div>
<h4 id="running-a-recipe">Running a Recipe</h4>
<p>Write a recipe in a file, such as
<code>busted-vaal-regalia.kld</code> (start from an <a
href="#example-recipe">Example Recipe</a>), and ask
<code>kalandralang</code> to run it:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kalandralang</span> run busted-vaal-regalia.kld</span></code></pre></div>
<h4 id="finding-identifiers">Finding Identifiers</h4>
<p>Recipes contain identifiers for base object types and modifiers.
There are multiple ways to find those identifiers.</p>
<h5 id="using-the-find-command">Using the Find Command</h5>
<p>You can use the <code>find</code> command to find them.</p>
<p>For instance, to find the identifier for the Agate Amulet base
type:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kalandralang</span> find agate</span></code></pre></div>
<p>This tells you that the identifier is
<code>"Metadata/Items/Amulets/Amulet9"</code>. This is the internal name
in Path of Exile data files.</p>
<p>To find the identifier for the +1 to Level of all Chaos Skill
Gems:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kalandralang</span> find <span class="st">&#39;level*chaos skill&#39;</span></span></code></pre></div>
<p>This finds all base types and modifiers that match pattern
<code>level*chaos skill</code>, where <code>*</code> can be anything.
This gives two results:</p>
<ul>
<li><code>"GlobalChaosGemLevelInfluence1__"</code>, the old Hunter
(known as "basilisk" internally) influence mod which now has a spawn
weight of 0 and thus cannot spawn anymore;</li>
<li><code>"GlobalChaosGemLevel1"</code>, the 3.17 non-influenced version
of the mod.</li>
</ul>
<h5 id="using-the-show-mod-pool-instruction">Using the Show Mod Pool
Instruction</h5>
<p>To find the identifier for a modifier, you can also use the
<code>show_mod_pool</code> instruction (see <a
href="#show-mod-pool">Show Mod Pool</a>). For instance, here is a recipe
that shows all modifiers that can spawn on a non-influenced Agate
Amulet:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We want the item to have no modifier so that we see all modifiers that can spawn.</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Otherwise, we would not see modifiers that are blocked by existing modifiers.</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># But we cannot just scour because no modifier can spawn on normal items.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># So we use annul until there is no modifier.</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Orbs of Annulments keep the item rare.</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="cf">until</span> <span class="ex">no_prefix</span> <span class="kw">&amp;&amp;</span> <span class="ex">no_suffix</span> do annul</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="ex">show_mod_pool</span></span></code></pre></div>
<h4 id="generate-cost-data">Generate Cost Data</h4>
<p>Kalandralang reads the cost of currencies, harvest crafts etc. from
file <code>data/costs.json</code>. It is a good idea to regularly update
this file. See <a href="#costs">Costs</a> for more information.</p>
<h5 id="from-poeninja">From poe.ninja</h5>
<p>The following command uses <a
href="https://poe.ninja">poe.ninja</a>'s API to generate file
`data/costs.json` :</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kalandralang</span> write-ninja-costs</span></code></pre></div>
<p>If you are from the future, you may need to specify the league
name:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kalandralang</span> write-ninja-costs Archnemesis</span></code></pre></div>
<p>Note that <code>write-ninja-costs</code> uses default values for
crafts that are not listed on <a
href="https://poe.ninja">poe.ninja</a>:</p>
<ul>
<li><a href="#harvest-crafting">Harvest crafts</a>;</li>
<li><a href="#betrayal-crafting">Betrayal crafts</a>.</li>
</ul>
<h5 id="with-default-values">With Default Values</h5>
<p>The following command generates file <code>data/costs.json</code>
with default values:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kalandralang</span> write-default-costs</span></code></pre></div>
<h2 id="example-recipe">Example Recipe</h2>
<h3 id="code">Code</h3>
<p>Here is an example recipe to make a fire amulet. You can also find
the code in <code>examples/fire-amulet.kld</code>.</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This recipe produces Citrine Amulets with:</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - +1 to Level of All Fire Skill Gems</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Life</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - Increased Fire Damage</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - Increased Cast Speed</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - Increased Spell Damage</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we buy a base.</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Citrine Amulet&#39;s internal name is &quot;Metadata/Items/Amulets/Amulet10&quot;.</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># To find this identifier, run: kalandralang find citrine</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># We buy one with item level 84 for 1 chaos.</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Kalandralang will choose a random rare amulet for us.</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet10&quot;</span> ilvl 84 for 1 chaos</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s display the current item.</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Item we bought:&quot;</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="ex">show</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we start working on the suffixes.</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># We spam Deafening Essence of Zeal until the amulet has both the essence mod</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># (i.e. Increased Cast Speed) and Tier 1 Increased Fire Damage.</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Increased Fire Damage&#39;s internal name is &quot;FireDamagePercent5&quot;.</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co"># To find this identifier, run: kalandralang find &#39;increased fire damage&#39;</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co"># This gives a lot of results; an alternative is to go to</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="co"># https://poedb.tw/us/Amulets#ModifiersCalc, click on the mod you are interested in,</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="co"># click on the &quot;i&quot; icon next to the tier you want, and copy-paste the Mod Id.</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;repeat&quot; causes the instruction (here &quot;essence_of_zeal&quot;) to always be executed</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="co"># at least once. This ensures that we do have the essence mod even if the amulet</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="co"># already had &quot;FireDamagePercent5&quot; when we bought it.</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="ex">repeat</span> essence_of_zeal until has <span class="st">&quot;FireDamagePercent5&quot;</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s display the current item.</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Item after essence spam:&quot;</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="ex">show</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Now that we are happy with our suffixes, we start working on our prefixes.</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="co"># We will use Harvest to augment fire.</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="co"># But first we need to make sure the amulet has two open prefixes:</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a><span class="co"># - one for the augment itself;</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a><span class="co"># - and one to craft Adds # to # Fire Damage to Attacks</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   to ensure the augment gives us +1 to Level of All Fire Skill Gems.</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Additionally, we take the opportunity to ensure that we have Increased Spell Damage</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="co"># on the amulet.</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="co"># To do that, we use Harvest to reforge keeping suffixes until there are</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a><span class="co"># two open prefixes (i.e. exactly 1 prefix), and Increased Spell Damage.</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a><span class="co"># The internal name for this modifier is:</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a><span class="co"># - &quot;SpellDamage5&quot; for Tier 1;</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a><span class="co"># - &quot;SpellDamage4&quot; for Tier 2.</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a><span class="co"># We are happy with Tier 2, but it doesn&#39;t mean we don&#39;t want Tier 1,</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a><span class="co"># so our stopping condition checks for both mods.</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;until&quot; does not execute the instruction (here &quot;harvest_reforge_keep_suffixes&quot;)</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a><span class="co"># if the condition already holds.</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a><span class="cf">until</span> <span class="ex">prefix_count</span> 1 and <span class="er">(</span><span class="ex">has</span> <span class="st">&quot;SpellDamage5&quot;</span> or has <span class="st">&quot;SpellDamage4&quot;</span><span class="kw">)</span> <span class="cf">do</span> <span class="kw">{</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>  <span class="ex">harvest_reforge_keep_suffixes</span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s display the current item.</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Item after harvest reforges:&quot;</span></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a><span class="ex">show</span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s craft Adds # to # Fire Damage to Attacks and augment fire to get</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a><span class="co"># our +1 to Level of All Fire Skill Gems.</span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a><span class="ex">craft</span> <span class="st">&quot;EinharMasterAddedFireDamage1&quot;</span></span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a><span class="ex">harvest_augment_fire</span></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, let&#39;s craft life and call it a day!</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a><span class="ex">remove_crafted_mods</span></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a><span class="ex">craft</span> <span class="st">&quot;EinharMasterIncreasedLife3&quot;</span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s say that we can sell this for 10 Exalted Orbs.</span></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a><span class="ex">gain</span> 10 exalt</span></code></pre></div>
<h3 id="run-once">Run Once</h3>
<p>Run this recipe with:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kalandralang</span> run examples/fire-amulet.kld</span></code></pre></div>
<p>Here is an example run:</p>
<pre><code>Item we bought:
--------
Citrine Amulet (Rare)
--------
(prefix) +29 to maximum Life (IncreasedLife2)
(prefix) 20% increased maximum Energy Shield (IncreasedEnergyShieldPercent7)
(suffix) +24% to Global Critical Strike Multiplier (CriticalMultiplier3)
(suffix) +17% to Cold Resistance (ColdResist2)
--------
Paid up to now: 0.01ex (1c)
Item after essence spam:
--------
Citrine Amulet (Rare)
--------
(prefix) 0.73% of Physical Attack Damage Leeched as Life (LifeLeechPermyriad2)
(suffix) 25% increased Fire Damage (FireDamagePercent5)
(suffix) 18% increased Cast Speed (IncreasedCastSpeed4)
(suffix) +38% to Global Critical Strike Multiplier (CriticalMultiplier6)
--------
Paid up to now: 3.49ex (604c)
Item after harvest reforges:
--------
Citrine Amulet (Rare)
--------
(prefix) 18% increased Spell Damage (SpellDamage4)
(suffix) 24% increased Fire Damage (FireDamagePercent5)
(suffix) 18% increased Cast Speed (IncreasedCastSpeed4)
(suffix) +36% to Global Critical Strike Multiplier (CriticalMultiplier6)
--------
Paid up to now: 18.49ex (3198c)
--------
Citrine Amulet (Rare)
--------
(prefix) 18% increased Spell Damage (SpellDamage4)
(prefix) +1 to Level of all Fire Skill Gems (GlobalFireGemLevel1_)
(suffix) 23% increased Fire Damage (FireDamagePercent5)
(suffix) 18% increased Cast Speed (IncreasedCastSpeed4)
(suffix) +38% to Global Critical Strike Multiplier (CriticalMultiplier6)
(prefix) {crafted} +45 to maximum Life (EinharMasterIncreasedLife3)
--------
Cost:
     1 × chaos
    10 × harvest_reforge_keep_suffixes
     1 × remove_crafted_mods
   201 × essence_of_zeal
     1 × harvest_augment_fire
     1 × craft &quot;EinharMasterAddedFireDamage1&quot;
     1 × craft &quot;EinharMasterIncreasedLife3&quot;
Total: 28.50ex (4928c) — Profit: -18.50ex (-3198c)</code></pre>
<h3 id="run-100-times">Run 100 Times</h3>
<p>Run this recipe 100 times with:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kalandralang</span> run examples/fire-amulet.kld <span class="at">-c</span> 100</span></code></pre></div>
<p>Kalandralang eventually tells us:</p>
<pre><code>Average cost (out of 100):
     1.00 × chaos
    75.55 × harvest_reforge_keep_suffixes
     1.00 × remove_crafted_mods
   152.01 × essence_of_zeal
     1.00 × harvest_augment_fire
     1.00 × craft &quot;EinharMasterAddedFireDamage1&quot;
     1.00 × craft &quot;EinharMasterIncreasedLife3&quot;
Total: 125.97ex (21785c) — Profit: -115.97ex (-20055c)

     █                                                                          
   ▆ █                                                                          
   █ █ ▅   ▅                                                                    
 ▃ █ █ █  ▃█                                                                    
 █ █ █ █ ▂██                                                                    
 █ █ █ █ ███                                                                    
 █ █████ ███                                                                    
 █▆█████▆███                                                                    
 ███████████▅ ▅      ▅                                                          
 ████████████ █▃▃▃  ▃█▃ ▃                                                       
▂████████████ ████▂ ███ █▂▂    ▂                ▂                               
█████████████ █████ ███ ███    █                █                               
‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾
0ex                                                                       1000ex</code></pre>
<p>It looks like this recipe is really not worth it!</p>
<p>It looks like hoping to get Increased Spell Damage with Harvest
reforge keeping suffixes is very costly. Using Harvest augment fire to
get +1 to Level of All Fire Skill Gems is also not cheap, maybe we
should have started with the prefixes by spamming Alteration Orbs. Can
you improve the recipe to make it less ambitious but also less
catastrophic?</p>
<h2 id="costs">Costs</h2>
<p>To estimate the cost of each craft, Kalandralang needs to know the
value of currencies, harvest crafts etc. Kalandralang has default values
for each of those, but those values are unlikely to be very accurate as
values change a lot over time. You can customize those values by
creating a file named <code>costs.json</code> in the <code>data</code>
directory that you set up in <a href="#setup-a-working-directory">Setup
a Working Directory</a>.</p>
<p>To customize costs, it is recommended to generate
<code>data/costs.json</code> using <code>write-default-costs</code> or
<code>write-ninja-costs</code> (see <a
href="#generate-cost-data">Generate Cost Data</a>). You can then edit
the values in this file manually.</p>
<p>This file is a <a href="https://www.json.org">JSON</a> file composed
of one JSON object. The name of each field is usually a keyword
corresponding to an instruction. For instance, field
<code>"exalt"</code> specifies the value of Exalted Orbs, field
<code>"harvest_reforge_life"</code> specifies the cost of the
<code>harvest_reforge_life</code> <a
href="#harvest-crafting">instruction</a>, and field
<code>"pristine"</code> specifies the value of Pristine Fossils. For
resonators, the fields are named <code>"primitive_resonator"</code>,
<code>"potent_resonator"</code>, <code>"powerful_resonator"</code> and
<code>"prime_resonator"</code>.</p>
<p>The value of each field is either:</p>
<ul>
<li>a number, specifying the value in Chaos Orbs;</li>
<li>or an object, specifying the value in terms of the value of other
instructions.</li>
</ul>
<p>For instance, the following <code>costs.json</code> file:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;exalt&quot;</span><span class="fu">:</span> <span class="dv">150</span><span class="fu">,</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;hunter_exalt&quot;</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">&quot;exalt&quot;</span><span class="fu">:</span> <span class="fl">1.5</span> <span class="fu">}</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>specifies that the value of Exalted Orbs is 150 Chaos Orbs, and that
the value of Hunter Exalted Orbs is 1.5 Exalted Orbs (i.e. 225 Chaos
Orbs).</p>
<p>You can specify multiple fields in values. The resulting value is the
sum. For instance:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;hunter_exalt&quot;</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">&quot;exalt&quot;</span><span class="fu">:</span> <span class="fl">1.5</span><span class="fu">,</span> <span class="dt">&quot;chaos&quot;</span><span class="fu">:</span> <span class="dv">10</span> <span class="fu">}</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>specifies that the value of Hunter Exalted Orbs is 1.5 Exalted Orbs,
plus 10 Chaos Orbs.</p>
<p>You cannot specify the value of Chaos Orbs themselves, but you can
use them in definitions of other values. Most of the time though you
would just put a number directly as Chaos Orb is the default unit.</p>
<p>If the value of a given instruction is not specified (i.e. does not
appear in the file or is defined as <code>null</code>), its default
value is used.</p>
<h2 id="language-reference">Language Reference</h2>
<h3 id="general-syntax-rules">General Syntax Rules</h3>
<h4 id="comments">Comments</h4>
<p>Comments start with character <code>#</code> and end at the end of
lines. For instance:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This line is a comment</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">exalt</span> <span class="co"># This is also a comment, but &quot;exalt&quot; isn&#39;t</span></span></code></pre></div>
<p>Comments are ignored by the interpreter. Use them to make your code
more readable.</p>
<h4 id="keywords">Keywords</h4>
<p>Keywords are composed of lowercase letters (<code>a</code> to
<code>z</code>) and underscores <code>_</code>. They are predefined and
correspond to language instructions. Here are some examples:</p>
<ul>
<li><code>harvest_reforge_life</code>;</li>
<li><code>chaos</code>;</li>
<li><code>while</code>.</li>
</ul>
<h4 id="numbers">Numbers</h4>
<p>Numbers are sequences of digits (<code>0</code> to <code>9</code>),
optionally prefixed by a minus character <code>-</code> for negative
numbers. Examples:</p>
<ul>
<li><code>0</code>;</li>
<li><code>1234</code>;</li>
<li><code>-9</code>.</li>
</ul>
<h4 id="identifiers">Identifiers</h4>
<p>Identifiers start and end with double quotes <code>"</code>. For
instance:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">has</span> <span class="st">&quot;GlobalSkillGemLevel1&quot;</span> then gain 15 exalt</span></code></pre></div>
<p>In this example, <code>"GlobalSkillGemLevel1"</code> is the
identifier for the +1 to Level of all Chaos Skill Gems modifier.</p>
<p>See also <a href="#finding-identifiers">Finding Identifiers</a>.</p>
<h4 id="variables-and-functions">Variables and functions</h4>
<p>Variable and function names are unreserved sequences of lowercase
letters (<code>a</code> to <code>z</code>) and underscores
<code>_</code> (like keywords). Functions must be declared before all
other instructions. Variables and functions hold and return integers. A
function without a return statement or an uninitialized variable
evaluates to <code>0</code>. Examples:</p>
<ul>
<li><code>my_variable = 0</code>;</li>
<li><code>function my_function arg1 arg2 = return arg1 + arg2</code>.</li>
</ul>
<h4 id="labels">Labels</h4>
<p>Labels start with a period <code>.</code> which is followed by
lowercase or uppercase letters (<code>a</code> to <code>z</code> and
<code>A</code> to <code>Z</code>), digits (<code>0</code> to
<code>9</code>), and underscores <code>_</code>. They are used to refer
to a given position in the code, to be able to jump to this position
from other parts of the code. Here are some examples:</p>
<ul>
<li><code>.attempt_to_reforge_life</code>;</li>
<li><code>.fail_miserably_for_the_3rd_time_and_try_again</code>.</li>
</ul>
<p>Well-chosen label names help to make the code more readable.</p>
<h4 id="symbols">Symbols</h4>
<p>The language uses the following symbol characters:</p>
<ul>
<li>parentheses <code>(</code> and <code>)</code> in condition
expressions;</li>
<li>braces <code>{</code> and <code>}</code> for blocks of
instructions;</li>
<li>colon <code>:</code> after label definitions;</li>
<li>dash <code>-</code> (also known as "minus") for ranges of
values.</li>
</ul>
<h4 id="whitespace">Whitespace</h4>
<p>In general, whitespace (blanks, tabs and newlines) is ignored.
Although you do have to separate keywords and numbers with whitespace
(for instance <code>abc</code> is one keyword, but <code>a bc</code> is
two), and newlines do matter to end comments.</p>
<h3 id="computational-model">Computational Model</h3>
<h4 id="program-point">Program Point</h4>
<p>Recipes are sequences of instructions. For instance:</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">transmute</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ex">regal</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ex">exalt</span></span></code></pre></div>
<p>is a recipe composed of three instructions. The first one is to apply
an Orb of Transmutation, the second one is to apply a Regal Orb, and the
third one is to apply an Exalted Orb.</p>
<p>When executing a recipe, Kalandralang keeps track of the <em>program
point</em>, which is the next instruction to perform. At the very start,
this is the first instruction of the program. After each instruction,
the program point automatically moves on to the next instruction in the
sequence, except if the instruction which was just executed is a <a
href="#control-flow-instructions">Control-Flow Instruction</a>, in which
case it may move somewhere else.</p>
<h4 id="current-item">Current Item</h4>
<p>When executing a recipe, Kalandralang stores a <em>current item</em>
in memory. At the very start, there is no current item, so usually the
first instruction is to <code>buy</code> a base (see <a
href="#buying-a-base">Buying a Base</a>). After that, each instruction
can modify the current item or replace it completely. For instance,
<code>transmute</code> is an instruction that applies an Orb of
Transmutation on the current item.</p>
<p>Some instructions contain conditions. Those conditions are evaluated
on the current item. For instance, <code>no_suffix</code> is a condition
that evaluates to <code>true</code> if the current item has no
suffix.</p>
<h4 id="set-aside-item">Set-Aside Item</h4>
<p>When executing a recipe, Kalandralang stores a <em>set-aside
item</em> in memory. At the very start, there is no set-aside item. Use
the <code>set_aside</code> instruction to set the current item aside
(see <a href="#set-aside">Set Aside</a>). Items can be set aside for <a
href="#awakeners-orb">Awakener's Orb</a> in particular. Note that <a
href="#split">Splitting</a> an item replaces the set-aside item.</p>
<h4 id="current-imprint">Current Imprint</h4>
<p>When executing a recipe, Kalandralang stores a <em>current
imprint</em> in memory. At the very start, there is no current imprint.
Use the <code>beastcraft_imprint</code> instruction to make an imprint
of the current item (see <a href="#imprint">Imprint</a>). Use the
<code>use_imprint</code> instruction to restore the current item to the
current imprint (see <a href="#use-imprint">Use Imprint</a>).</p>
<h4 id="spendings-and-gains">Spendings and Gains</h4>
<p>When executing a recipe, Kalandralang counts how much you spend. Each
instruction can add to this number. For instance, <code>exalt</code>
adds one Exalted Orb to your spendings. Kalandralang also counts how
much you gain (see <a href="#selling">Selling</a>). At the end,
Kalandralang can show total spendings and earnings.</p>
<h4 id="errors">Errors</h4>
<p>It may be possible for instructions to fail. For instance,
<code>transmute</code> fails if the current item is not of normal
rarity. Failures cause the recipe to stop immediately with an error
message. If this happens, you should modify your recipe to ensure that
it does not try to perform invalid instructions. For instance, you could
add an <code>if</code> instruction before an <code>augment</code> to
only perform the <code>augment</code> if the item has an open prefix or
an open suffix:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">open_prefix</span> or open_suffix then augment</span></code></pre></div>
<h3 id="buying-a-base">Buying a Base</h3>
<p><code>buy [&lt;influence&gt;] [&lt;influence&gt;] &lt;identifier&gt; [ilvl &lt;number&gt;] [with [fractured] &lt;identifier&gt;]* [for &lt;amount&gt;]</code>
is an instruction that sets or replaces the current item to a given
base.</p>
<ul>
<li><code>&lt;influence&gt;</code> are keywords that can be used to
specify that the item has this influence. Zero, one or two influences
can be specified. Influence keywords are: <code>shaper</code>,
<code>elder</code>, <code>crusader</code>, <code>hunter</code>,
<code>redeemer</code>, <code>warlord</code>, <code>exarch</code>,
<code>eater</code>, <code>synthesized</code>.</li>
<li>The first identifier is the base type, such as
<code>"Metadata/Items/Amulets/Amulet9"</code> for Agate Amulets.</li>
<li><code>ilvl &lt;number&gt;</code> is optional and sets the item
level. It defaults to 100. For instance, <code>ilvl 84</code> sets the
item level to 84.</li>
<li><code>with &lt;identifier&gt;</code> constrains the item to have a
given modifier, specified with the given identifier. For instance,
<code>with "GlobalChaosGemLevel1"</code> specifies that the item must
have +1 to Level of all Chaos Skill Gems. This parameter is
repeatable.</li>
<li><code>with fractured &lt;identifier&gt;</code> is the same as
<code>with &lt;identifier&gt;</code> but the modifier is fractured.</li>
<li><code>for &lt;amount&gt;</code> specifies the cost of the item. It
causes the given <a href="#amounts">Amount</a> to be added to your <a
href="#spendings-and-gains">Spendings</a>. It defaults to zero.</li>
</ul>
<p>Note that the base item will be rare, with 4 to 6 modifiers,
following the distribution of chaos orbs. If you specify one modifier,
the item will have 3 to 5 other modifiers at random. If you specify two
modifiers, the item will have 2 to 4 other modifiers at random. Etc.</p>
<p>For instance, here is how to start from a random rare Agate Amulet of
item level 100:</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></span></code></pre></div>
<p>Here is how to start from a normal rarity, hunter-influenced Agate
Amulet of item level 86:</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">buy</span> hunter <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span> ilvl 86</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="ex">scour</span></span></code></pre></div>
<p>Here is how to start from a random rare hunter and warlord-influenced
Agate Amulet of item level 100:</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">buy</span> hunter warlord <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></span></code></pre></div>
<p>Here is how to start from a rare ilvl 86 Agate Amulet with fractured
+1 to Level of all Chaos Skill Gems and Tier 1 Dexterity (and some other
random modifiers), bought for 10 Chaos Orbs:</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">ilvl</span> 86</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">with</span> fractured <span class="st">&quot;GlobalChaosGemLevel1&quot;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">with</span> <span class="st">&quot;Dexterity9&quot;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="ex">10</span> chaos</span></code></pre></div>
<p>Note that <code>"Dexterity9"</code> is Tier 1, not Tier 9. This is
how modifiers are named internally in the game.</p>
<h3 id="crafting-instructions">Crafting Instructions</h3>
<h4 id="currencies">Currencies</h4>
<p>The following keywords are instructions to apply currency to the
current item.</p>
<h5 id="basic-currencies">Basic Currencies</h5>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Currency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>transmute</code></td>
<td>Orb of Transmutation</td>
</tr>
<tr class="even">
<td><code>augment</code></td>
<td>Orb of Augmentation</td>
</tr>
<tr class="odd">
<td><code>alt</code></td>
<td>Orb of Alteration</td>
</tr>
<tr class="even">
<td><code>regal</code></td>
<td>Regal Orb</td>
</tr>
<tr class="odd">
<td><code>alch</code></td>
<td>Orb of Alchemy</td>
</tr>
<tr class="even">
<td><code>scour</code></td>
<td>Orb of Scouring</td>
</tr>
<tr class="odd">
<td><code>bless</code></td>
<td>Blessed Orb</td>
</tr>
<tr class="even">
<td><code>chaos</code></td>
<td>Chaos Orb</td>
</tr>
<tr class="odd">
<td><code>annul</code></td>
<td>Orb of Annulment</td>
</tr>
<tr class="even">
<td><code>exalt</code></td>
<td>Exalted Orb</td>
</tr>
</tbody>
</table>
<h5 id="conqueror-exalted-orbs">Conqueror Exalted Orbs</h5>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Currency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>crusader_exalt</code></td>
<td>Crusader Exalted Orb</td>
</tr>
<tr class="even">
<td><code>hunter_exalt</code></td>
<td>Hunter Exalted Orb</td>
</tr>
<tr class="odd">
<td><code>redeemer_exalt</code></td>
<td>Redeemer Exalted Orb</td>
</tr>
<tr class="even">
<td><code>warlord_exalt</code></td>
<td>Warlord Exalted Orb</td>
</tr>
</tbody>
</table>
<h5 id="eldritch-currencies">Eldritch Currencies</h5>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Currency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>lesser_ember</code></td>
<td>Lesser Eldritch Ember</td>
</tr>
<tr class="even">
<td><code>greater_ember</code></td>
<td>Greater Eldritch Ember</td>
</tr>
<tr class="odd">
<td><code>grand_ember</code></td>
<td>Grand Eldritch Ember</td>
</tr>
<tr class="even">
<td><code>exceptional_ember</code></td>
<td>Exceptional Eldritch Ember</td>
</tr>
<tr class="odd">
<td><code>lesser_ichor</code></td>
<td>Lesser Eldritch Ichor</td>
</tr>
<tr class="even">
<td><code>greater_ichor</code></td>
<td>Greater Eldritch Ichor</td>
</tr>
<tr class="odd">
<td><code>grand_ichor</code></td>
<td>Grand Eldritch Ichor</td>
</tr>
<tr class="even">
<td><code>exceptional_ichor</code></td>
<td>Exceptional Eldritch Ichor</td>
</tr>
<tr class="odd">
<td><code>eldritch_annul</code></td>
<td>Eldritch Orb of Annulment</td>
</tr>
<tr class="even">
<td><code>eldritch_exalt</code></td>
<td>Eldritch Exalted Orb</td>
</tr>
<tr class="odd">
<td><code>eldritch_chaos</code></td>
<td>Eldritch Chaos Orb</td>
</tr>
</tbody>
</table>
<h5 id="betrayal-currencies">Betrayal Currencies</h5>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Currency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>veiled_chaos</code></td>
<td>Veiled Chaos Orb</td>
</tr>
</tbody>
</table>
<h5 id="awakeners-orb">Awakener's Orb</h5>
<p>The <code>awaken</code> instruction applies an Awakener's Orb on the
<a href="#set-aside-item">Set-Aside Item</a> to destroy it and add its
influence to the <a href="#current-item">Current Item</a>. For instance,
here is how to destroy a hunter-influenced Agate Amulet to add hunter
influence to a warlord Marble Amulet:</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">buy</span> hunter <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">with</span> <span class="st">&quot;AdditionalPierceInfluence1&quot;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="ex">set_aside</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="ex">buy</span> warlord <span class="st">&quot;Metadata/Items/Amulet/AmuletAtlas2&quot;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">with</span> <span class="st">&quot;AreaOfEffectInfluence3&quot;</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="ex">awaken</span></span></code></pre></div>
<p>This usually results in a Marble Amulet with the hunter modifier
Projectiles Pierce an additional Target and the warlord modifier #%
increased Area of Effect. But as both items could have more than one
influenced modifier, this is not guaranteed.</p>
<h4 id="essences">Essences</h4>
<p>The following keywords are instructions to apply an essence to the
current item.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Essence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>essence_of_anger</code></td>
<td>Deafening Essence of Anger</td>
</tr>
<tr class="even">
<td><code>essence_of_anguish</code></td>
<td>Deafening Essence of Anguish</td>
</tr>
<tr class="odd">
<td><code>essence_of_contempt</code></td>
<td>Deafening Essence of Contempt</td>
</tr>
<tr class="even">
<td><code>essence_of_doubt</code></td>
<td>Deafening Essence of Doubt</td>
</tr>
<tr class="odd">
<td><code>essence_of_dread</code></td>
<td>Deafening Essence of Dread</td>
</tr>
<tr class="even">
<td><code>essence_of_envy</code></td>
<td>Deafening Essence of Envy</td>
</tr>
<tr class="odd">
<td><code>essence_of_fear</code></td>
<td>Deafening Essence of Fear</td>
</tr>
<tr class="even">
<td><code>essence_of_greed</code></td>
<td>Deafening Essence of Greed</td>
</tr>
<tr class="odd">
<td><code>essence_of_hatred</code></td>
<td>Deafening Essence of Hatred</td>
</tr>
<tr class="even">
<td><code>essence_of_loathing</code></td>
<td>Deafening Essence of Loathing</td>
</tr>
<tr class="odd">
<td><code>essence_of_misery</code></td>
<td>Deafening Essence of Misery</td>
</tr>
<tr class="even">
<td><code>essence_of_rage</code></td>
<td>Deafening Essence of Rage</td>
</tr>
<tr class="odd">
<td><code>essence_of_scorn</code></td>
<td>Deafening Essence of Scorn</td>
</tr>
<tr class="even">
<td><code>essence_of_sorrow</code></td>
<td>Deafening Essence of Sorrow</td>
</tr>
<tr class="odd">
<td><code>essence_of_spite</code></td>
<td>Deafening Essence of Spite</td>
</tr>
<tr class="even">
<td><code>essence_of_suffering</code></td>
<td>Deafening Essence of Suffering</td>
</tr>
<tr class="odd">
<td><code>essence_of_torment</code></td>
<td>Deafening Essence of Torment</td>
</tr>
<tr class="even">
<td><code>essence_of_woe</code></td>
<td>Deafening Essence of Woe</td>
</tr>
<tr class="odd">
<td><code>essence_of_wrath</code></td>
<td>Deafening Essence of Wrath</td>
</tr>
<tr class="even">
<td><code>essence_of_zeal</code></td>
<td>Deafening Essence of Zeal</td>
</tr>
<tr class="odd">
<td><code>essence_of_delirium</code></td>
<td>Essence of Delirium</td>
</tr>
<tr class="even">
<td><code>essence_of_horror</code></td>
<td>Essence of Horror</td>
</tr>
<tr class="odd">
<td><code>essence_of_hysteria</code></td>
<td>Essence of Hysteria</td>
</tr>
<tr class="even">
<td><code>essence_of_insanity</code></td>
<td>Essence of Insanity</td>
</tr>
</tbody>
</table>
<h4 id="fossils">Fossils</h4>
<p>The following keywords are instructions to apply fossils to the
current item. To apply multiple fossils, separate those keywords with
<code>+</code>.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Fossil</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>aberrant</code></td>
<td>Aberrant Fossil</td>
</tr>
<tr class="even">
<td><code>aetheric</code></td>
<td>Aetheric Fossil</td>
</tr>
<tr class="odd">
<td><code>bound</code></td>
<td>Bound Fossil</td>
</tr>
<tr class="even">
<td><code>corroded</code></td>
<td>Corroded Fossil</td>
</tr>
<tr class="odd">
<td><code>dense</code></td>
<td>Dense Fossil</td>
</tr>
<tr class="even">
<td><code>faceted</code></td>
<td>Faceted Fossil</td>
</tr>
<tr class="odd">
<td><code>frigid</code></td>
<td>Frigid Fossil</td>
</tr>
<tr class="even">
<td><code>jagged</code></td>
<td>Jagged Fossil</td>
</tr>
<tr class="odd">
<td><code>lucent</code></td>
<td>Lucent Fossil</td>
</tr>
<tr class="even">
<td><code>metallic</code></td>
<td>Metallic Fossil</td>
</tr>
<tr class="odd">
<td><code>prismatic</code></td>
<td>Prismatic Fossil</td>
</tr>
<tr class="even">
<td><code>pristine</code></td>
<td>Pristine Fossil</td>
</tr>
<tr class="odd">
<td><code>scorched</code></td>
<td>Scorched Fossil</td>
</tr>
<tr class="even">
<td><code>serrated</code></td>
<td>Serrated Fossil</td>
</tr>
<tr class="odd">
<td><code>shuddering</code></td>
<td>Shuddering Fossil</td>
</tr>
<tr class="even">
<td><code>fundamental</code></td>
<td>Fundamental Fossil</td>
</tr>
<tr class="odd">
<td><code>deft</code></td>
<td>Deft Fossil</td>
</tr>
</tbody>
</table>
<p>For instance:</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pristine</span></span></code></pre></div>
<p>applies a Primitive Resonator socketed with a Pristine Fossil.</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">dense</span> + fundamental</span></code></pre></div>
<p>applies a Potent Resonator socketed with a Dense Fossil and a
Fundamental Fossil.</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">faceted</span> + aetheric + prismatic</span></code></pre></div>
<p>applies a Powerful Resonator socketed with a Faceted Fossil, an
Aetheric Fossil and a Prismatic Fossil.</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">metallic</span> + lucent + jagged + deft</span></code></pre></div>
<p>applies a Prime Resonator socketed with a Metallic Fossil, a Lucent
Fossil, a Jagged Fossil and a Deft Fossil.</p>
<h4 id="crafting-bench">Crafting Bench</h4>
<h5 id="built-ins">Built-Ins</h5>
<p>The following keywords are instructions to apply a specify crafting
bench operation on the current item using the crafting bench. All of
them add a given modifier, except <code>remove_crafted_mods</code> which
removes all crafted modifiers.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Modifier</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>multimod</code></td>
<td>Can have up to 3 crafted modifiers</td>
</tr>
<tr class="even">
<td><code>prefixes_cannot_be_changed</code></td>
<td>Prefixes cannot be changed</td>
</tr>
<tr class="odd">
<td><code>suffixes_cannot_be_changed</code></td>
<td>Suffixes cannot be changed</td>
</tr>
<tr class="even">
<td><code>cannot_roll_attack_mods</code></td>
<td>Cannot roll attack modifiers</td>
</tr>
<tr class="odd">
<td><code>cannot_roll_caster_mods</code></td>
<td>Cannot roll caster modifiers</td>
</tr>
<tr class="even">
<td><code>remove_crafted_mods</code></td>
<td>Remove crafted mods</td>
</tr>
<tr class="odd">
<td><code>craft_any_prefix</code></td>
<td>Add a cheap modifier chosen arbitrarily from the list of available
prefixes</td>
</tr>
<tr class="even">
<td><code>craft_any_suffix</code></td>
<td>Add a cheap modifier chosen arbitrarily from the list of available
suffixes</td>
</tr>
</tbody>
</table>
<p>Use <code>craft_any_prefix</code> and <code>craft_any_suffix</code>
when you want to craft a modifier without care for which one, for
instance to add a third prefix or suffix to prevent an exalt or a
reforge from adding a prefix or a suffix.</p>
<h5 id="other-modifiers">Other Modifiers</h5>
<p>To add another mod using the crafting bench, use the
<code>craft &lt;identifier&gt;</code> instruction. The identifier
specifies which mod to add. See <a href="#finding-identifiers">Finding
Identifiers</a> to find out which identifier to use. For instance, to
add Adds # to # Cold Damage (lowest tier), use:</p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">craft</span> <span class="st">&quot;DexMasterAddedColdDamageCrafted1&quot;</span></span></code></pre></div>
<p>Note that this operation has a very low estimated cost. It is
intended to be used to block modifiers. You can use it to add meta-mods
but the cost will not be estimated correctly. For meta-mods, use <a
href="#build-ins">Built-In</a> crafting bench operations instead.</p>
<h4 id="harvest-crafting">Harvest Crafting</h4>
<p>The following keywords are instructions to perform harvest crafts on
the current item.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Craft</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>harvest_augment_attack</code></td>
<td><strong>Augment</strong> an item with a new <strong>Attack</strong>
modifier</td>
</tr>
<tr class="even">
<td><code>harvest_augment_caster</code></td>
<td><strong>Augment</strong> an item with a new <strong>Caster</strong>
modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_augment_chaos</code></td>
<td><strong>Augment</strong> an item with a new <strong>Chaos</strong>
modifier</td>
</tr>
<tr class="even">
<td><code>harvest_augment_cold</code></td>
<td><strong>Augment</strong> an item with a new <strong>Cold</strong>
modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_augment_critical</code></td>
<td><strong>Augment</strong> an item with a new
<strong>Critical</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_augment_defences</code></td>
<td><strong>Augment</strong> an item with a new
<strong>Defences</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_augment_fire</code></td>
<td><strong>Augment</strong> an item with a new <strong>Fire</strong>
modifier</td>
</tr>
<tr class="even">
<td><code>harvest_augment_life</code></td>
<td><strong>Augment</strong> an item with a new <strong>Life</strong>
modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_augment_lightning</code></td>
<td><strong>Augment</strong> an item with a new
<strong>Lightning</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_augment_physical</code></td>
<td><strong>Augment</strong> an item with a new
<strong>Physical</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_augment_speed</code></td>
<td><strong>Augment</strong> an item with a new <strong>Speed</strong>
modifier</td>
</tr>
<tr class="even">
<td><code>harvest_non_attack_to_attack</code></td>
<td><strong>Remove</strong> a random <strong>non-Attack</strong>
modifier from an item and add a new <strong>Attack</strong>
modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_non_caster_to_caster</code></td>
<td><strong>Remove</strong> a random <strong>non-Caster</strong>
modifier from an item and add a new <strong>Attack</strong>
modifier</td>
</tr>
<tr class="even">
<td><code>harvest_non_chaos_to_chaos</code></td>
<td><strong>Remove</strong> a random <strong>non-Chaos</strong> modifier
from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_non_cold_to_cold</code></td>
<td><strong>Remove</strong> a random <strong>non-Cold</strong> modifier
from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_non_critical_to_critical</code></td>
<td><strong>Remove</strong> a random <strong>non-Critical</strong>
modifier from an item and add a new <strong>Attack</strong>
modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_non_defences_to_defences</code></td>
<td><strong>Remove</strong> a random <strong>non-Defences</strong>
modifier from an item and add a new <strong>Attack</strong>
modifier</td>
</tr>
<tr class="even">
<td><code>harvest_non_fire_to_fire</code></td>
<td><strong>Remove</strong> a random <strong>non-Fire</strong> modifier
from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_non_life_to_life</code></td>
<td><strong>Remove</strong> a random <strong>non-Life</strong> modifier
from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_non_lightning_to_lightning</code></td>
<td><strong>Remove</strong> a random <strong>non-Lightning</strong>
modifier from an item and add a new <strong>Attack</strong>
modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_non_physical_to_physical</code></td>
<td><strong>Remove</strong> a random <strong>non-Physical</strong>
modifier from an item and add a new <strong>Attack</strong>
modifier</td>
</tr>
<tr class="even">
<td><code>harvest_non_speed_to_speed</code></td>
<td><strong>Remove</strong> a random <strong>non-Speed</strong> modifier
from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_attack</code></td>
<td><strong>Reforge</strong> an item as a rare item with random
modifiers, including an <strong>Attack</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_caster</code></td>
<td><strong>Reforge</strong> an item as a rare item with random
modifiers, including a <strong>Caster</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_chaos</code></td>
<td><strong>Reforge</strong> an item as a rare item with random
modifiers, including a <strong>Chaos</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_cold</code></td>
<td><strong>Reforge</strong> an item as a rare item with random
modifiers, including a <strong>Cold</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_critical</code></td>
<td><strong>Reforge</strong> an item as a rare item with random
modifiers, including a <strong>Critical</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_defences</code></td>
<td><strong>Reforge</strong> an item as a rare item with random
modifiers, including a <strong>Defences</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_fire</code></td>
<td><strong>Reforge</strong> an item as a rare item with random
modifiers, including a <strong>Fire</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_life</code></td>
<td><strong>Reforge</strong> an item as a rare item with random
modifiers, including a <strong>Life</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_lightning</code></td>
<td><strong>Reforge</strong> an item as a rare item with random
modifiers, including a <strong>Lightning</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_physical</code></td>
<td><strong>Reforge</strong> an item as a rare item with random
modifiers, including a <strong>Physical</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_speed</code></td>
<td><strong>Reforge</strong> an item as a rare item with random
modifiers, including a <strong>Speed</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_keep_prefixes</code></td>
<td><strong>Reforge</strong> a rare item, keeping all
<strong>Prefixes</strong></td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_keep_suffixes</code></td>
<td><strong>Reforge</strong> a rare item, keeping all
<strong>Suffixes</strong></td>
</tr>
</tbody>
</table>
<h4 id="beastcrafting">Beastcrafting</h4>
<p>The following keywords are instructions to perform beastcrafts on the
current item.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Craft</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>beastcraft_aspect_of_the_avian</code></td>
<td>Add Aspect of the Avian</td>
</tr>
<tr class="even">
<td><code>beastcraft_aspect_of_the_cat</code></td>
<td>Add Aspect of the Cat</td>
</tr>
<tr class="odd">
<td><code>beastcraft_aspect_of_the_crab</code></td>
<td>Add Aspect of the Crab</td>
</tr>
<tr class="even">
<td><code>beastcraft_aspect_of_the_spider</code></td>
<td>Add Aspect of the Spider</td>
</tr>
<tr class="odd">
<td><code>beastcraft_split</code></td>
<td>See <a href="#split">Split</a></td>
</tr>
<tr class="even">
<td><code>beastcraft_imprint</code></td>
<td>See <a href="#imprint">Imprint</a></td>
</tr>
</tbody>
</table>
<h5 id="split">Split</h5>
<p><code>beastcraft_split</code> splits the current item into two items.
One of them becomes the <a href="#current-item">Current Item</a>, the
other becomes the <a href="#set-aside-item">Set-Aside Item</a>.</p>
<p>You can <a href="#swap">Swap</a> the current item and the set-aside
item to access the second item created by a split. For instance, to
split an item that has +1 to Level of all Chaos Skill Gems and set the
current item to the item that kept this modifier:</p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">beastcraft_split</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">not</span> has <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> then swap</span></code></pre></div>
<h5 id="imprint">Imprint</h5>
<p><code>beastcraft_imprint</code> sets the <a
href="#current-imprint">Current Imprint</a> to an imprint of the current
item.</p>
<p>The item can then be restored by <a href="#use-imprint">Using the
Imprint</a>. For instance, to try and add a suffix to an item which only
has one prefix which is +1 to Level of All Skill Gems:</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">.try_again:</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">beastcraft_imprint</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">regal</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="ex">prefix_count</span> 2 then {</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">use_imprint</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">goto</span> .try_again</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="er">}</span></span></code></pre></div>
<h4 id="betrayal-crafting">Betrayal Crafting</h4>
<p>The following keywords are instructions to perform crafting obtained
through the Immortal Syndicate on the current item.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Craft</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>aisling</code></td>
<td>Aisling T4: remove a random modifier and add a new veiled
modifier</td>
</tr>
</tbody>
</table>
<h4 id="set-aside">Set Aside</h4>
<p>The <code>set_aside</code> instruction sets the <a
href="#set-aside-item">Set-Aside Item</a> to the <a
href="#current-item">Current Item</a>, then sets the current item to no
item. You usually want to <a href="#buying-a-base">buy</a> another item
after that to get a new current item. Then you usually want to use an <a
href="#awakeners-orb">Awakener's Orb</a>.</p>
<h4 id="swap">Swap</h4>
<p>The <code>swap</code> instructions exchanges the <a
href="#current-item">Current Item</a> and the <a
href="#set-aside-item">Set-Aside Item</a>. It is in particular useful
when <a href="#split">Splitting</a> items.</p>
<h4 id="use-imprint">Use Imprint</h4>
<p>The <code>use_imprint</code> instruction sets the <a
href="#current-item">Current Item</a> to the <a
href="#current-imprint">Current Imprint</a>, and sets the current
imprint to no imprint.</p>
<h3 id="control-flow-instructions">Control-Flow Instructions</h3>
<p>Interesting crafts are not linear: what to do after a given step
often depends on the state of the item. Kalandralang allows you to
express <a href="#conditions">Conditions</a> and to jump to a different
<a href="#program-point">Program Point</a>, expressed with the use of a
<a href="#labels">Label</a>, depending on whether the condition holds or
not.</p>
<h4 id="blocks">Blocks</h4>
<p>Everywhere you can write an instruction, you can write a block of
instructions instead. A block is a sequence of instructions inside
braces <code>{ ... }</code>. For instance:</p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">prefixes_cannot_be_changed</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">scour</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>is equivalent to:</p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="ex">prefixes_cannot_be_changed</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="ex">scour</span></span></code></pre></div>
<p>Typically, blocks are used in conditionals and loops. For
instance:</p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">open_suffix</span> then {</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">prefixes_cannot_be_changed</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">scour</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>is <em>not</em> equivalent to:</p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">open_suffix</span> then</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">prefixes_cannot_be_changed</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">scour</span></span></code></pre></div>
<p>The latter recipe applies an Orb of Scouring whether there was an
open suffix or not, which is probably not what is intended according to
the indentation.</p>
<p>Blocks can have any number of instructions, including zero or one:
<code>{}</code> is a valid block which does nothing, and
<code>{ alt }</code> is equivalent to <code>alt</code>.</p>
<h4 id="nesting-complex-instructions">Nesting Complex Instructions</h4>
<p>Complex instructions are:</p>
<ul>
<li><a href="#if-conditionals">If Conditionals</a>;</li>
<li><a href="#while-loops">While Loops</a>;</li>
<li><a href="#while-loops">Until Loops</a>;</li>
<li><a href="#while-loops">Repeat Loops</a>.</li>
</ul>
<p>Complex instructions cannot be used directly inside other complex
instructions. They need to be put in a <a href="#blocks">Block</a>. For
instance:</p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">open_suffix</span> then</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="ex">open_prefix</span> then</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">multimod</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">scour</span></span></code></pre></div>
<p>will fail to parse. You should write this instead:</p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">open_suffix</span> then {</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="ex">open_prefix</span> then</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">multimod</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">scour</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<h4 id="label-definitions">Label Definitions</h4>
<p>A <a href="#labels">Label</a> followed by a colon <code>:</code>
gives a name to a program point to be able to jump to it from anywhere
else in the recipe. For instance:</p>
<div class="sourceCode" id="cb46"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="ex">.start:</span></span></code></pre></div>
<p>defines a label named <code>.start</code>. You can put this label at
the beginning of your recipe to be able to jump to it later if you brick
your item.</p>
<h4 id="goto">Goto</h4>
<p>The <code>goto &lt;label&gt;</code> instruction sets the <a
href="#program-point">Program Point</a> to the instruction that follows
the given label's definition. For instance:</p>
<div class="sourceCode" id="cb47"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="ex">.chaos-spam:</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">chaos</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">goto</span> .chaos-spam</span></code></pre></div>
<p>creates an infinite loop of chaos spamming. This will in fact never
end and you will have to interrupt Kalandralang using Ctrl+C.</p>
<p><code>goto</code> instructions can often be avoided using <a
href="#if-conditionals">If Conditionals</a> and <a
href="#loops">Loops</a>. In large programs, it is recommended to avoid
them at all costs. But crafting recipes are often small, and gotos can
sometimes actually make the recipe more readable.</p>
<h4 id="stop">Stop</h4>
<p>The <code>stop</code> instruction sets the <a
href="#program-point">Program Point</a> to just after the last
instruction of the recipe. This effectively causes the run to stop
immediately. This is equivalent to putting a <a href="#labels">Label</a>
at the end and using <a href="#goto">Goto</a> to jump to it.</p>
<h4 id="if-conditionals">If Conditionals</h4>
<p><code>if &lt;condition&gt; then &lt;instruction&gt;</code> executes
the given instruction, but only if the condition holds. For
instance:</p>
<div class="sourceCode" id="cb48"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">no_prefix</span> then augment</span></code></pre></div>
<p>causes an Orb of Augmentation to be applied on the current item if it
has no prefix.</p>
<p>Another form of if conditionals is
<code>if &lt;condition&gt; then &lt;instruction&gt; else &lt;instruction&gt;</code>.
It executes the <code>then</code> instruction if the condition holds, or
the <code>else</code> instruction if it doesn't. For instance:</p>
<div class="sourceCode" id="cb49"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">open_suffix</span> then exalt else annul</span></code></pre></div>
<p>causes an Exalted Orb to be applied on the current item if it has an
open suffix, and an Orb of Annulment it its suffixes are full.</p>
<h4 id="loops">Loops</h4>
<h5 id="while-loops">While Loops</h5>
<p><code>while &lt;condition&gt; do &lt;instruction&gt;</code> executes
the given instruction until the given condition no longer holds. If the
condition already does not hold before the while loop, the instruction
is not executed at all. For instance:</p>
<div class="sourceCode" id="cb50"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="ex">not</span> has <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> do alt</span></code></pre></div>
<p>is a recipe which spams Orbs of Alteration on the current item until
the item has +1 to Level of all Chaos Skill Gems. If the item already
has this modifier before the loop starts, no Orb of Alteration is used
at all. It is equivalent to:</p>
<div class="sourceCode" id="cb51"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="ex">.loop:</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="ex">has</span> <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> then goto .stop</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">alt</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">goto</span> .loop</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="ex">.stop:</span></span></code></pre></div>
<h5 id="until-loops">Until Loops</h5>
<p><code>until &lt;condition&gt; do &lt;instruction&gt;</code> executes
the given instruction until the given condition holds. If the condition
already holds before the while loop, the instruction is not executed at
all. For instance:</p>
<div class="sourceCode" id="cb52"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">until</span> <span class="ex">has</span> <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> do alt</span></code></pre></div>
<p>is equivalent to:</p>
<div class="sourceCode" id="cb53"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="ex">not</span> has <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> do alt</span></code></pre></div>
<h5 id="repeat-loops">Repeat Loops</h5>
<p><code>repeat &lt;instruction&gt; until &lt;condition&gt;</code>
executes the given instruction until the given condition holds. The
instruction is always executed at least once. For instance:</p>
<div class="sourceCode" id="cb54"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="ex">repeat</span> alt until has <span class="st">&quot;GlobalChaosGemLevel1&quot;</span></span></code></pre></div>
<p>is equivalent to:</p>
<div class="sourceCode" id="cb55"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="ex">alt</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="cf">until</span> <span class="ex">has</span> <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> do alt</span></code></pre></div>
<p>and to:</p>
<div class="sourceCode" id="cb56"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="ex">.loop:</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">alt</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="ex">not</span> has <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> then goto .loop</span></code></pre></div>
<h3 id="selling">Selling</h3>
<p><code>gain &lt;amount&gt;</code> causes the given <a
href="#amounts">Amount</a> to be added to your earnings. It is typically
used at the end of recipes to estimate profit margins. For instance,
let's say that you want to estimate whether spamming Orbs of Alteration
to get +1 to Level of all Chaos Skill Gems is more efficient than buying
on the trade site, assuming you can sell the result for 20 chaos:</p>
<div class="sourceCode" id="cb57"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="cf">until</span> <span class="ex">has</span> <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> alt</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="ex">gain</span> 20 chaos</span></code></pre></div>
<p>Kalandralang will execute the recipe and display your spendings, your
earnings (here 20 Chaos Orbs), and the difference between the two.</p>
<p>This is not a very interesting example though because you can just
add 20 chaos from the spendings in your head. However, when combined
with <a href="#if-conditionals">If Conditionals</a>, you can tell
Kalandralang that the selling price depends on which mods the item has.
For instance:</p>
<div class="sourceCode" id="cb58"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="cf">until</span> <span class="ex">has</span> <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> alt</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="ex">gain</span> 20 chaos</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">has</span> <span class="st">&quot;Dexterity9&quot;</span> gain 30 chaos</span></code></pre></div>
<p>The earnings of this recipe depend on whether the item ends up with
Tier 1 Dexterity or not. If it does end up with Tier 1 Dexterity, the
earnings are 50 chaos. Otherwise, they are 20 chaos. This is
particularly useful for recipes that can fail but for which the
resulting item is still sellable.</p>
<h3 id="other-instructions">Other Instructions</h3>
<h4 id="echo">Echo</h4>
<p><code>echo &lt;string&gt;</code> causes Kalandralang to output the
given string. This is useful to know what is happening when debugging
recipes, or simply to comment on what is going on. For instance:</p>
<div class="sourceCode" id="cb59"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Will now try to obtain a veiled mod through Aisling.&quot;</span></span></code></pre></div>
<h4 id="show">Show</h4>
<p><code>show</code> causes Kalandralang to output the current item and
the total amount we spent up to now. This is useful when debugging
recipes, or simply to mark milestones in the recipe. It can typically be
preceded by <code>echo</code>, for instance:</p>
<div class="sourceCode" id="cb60"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Prefixes are done:&quot;</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="ex">show</span></span></code></pre></div>
<h4 id="show-mod-pool">Show Mod Pool</h4>
<p><code>show_mod_pool</code> causes Kalandralang to output the mods
that could be added to the current item and the chance to add them when
adding a single modifier (e.g. using an Exalted Orb). This also shows
the <a href="#identifiers">Identifier</a> of each mod.</p>
<p>This does not show mods that are blocked by other existing modifiers.
If the suffixes are full, it will not show any suffix, and if the
prefixes are full, it will not show any prefix. In particular, if the
item rarity is normal, this will never show anything.</p>
<p>Example:</p>
<div class="sourceCode" id="cb61"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Modifiers that can be added:&quot;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="ex">show_mod_pool</span></span></code></pre></div>
<h3 id="amounts">Amounts</h3>
<p>Amounts are sequences of numbers followed by currencies. More
precisely, amounts are of the form
<code>(&lt;number&gt; &lt;currency&gt;)*</code>. For instance:</p>
<ul>
<li><code>10 chaos</code> means 10 Chaos Orbs;</li>
<li><code>1 exalt 10 annul</code> means 1 Exalted Orb and 10 Orbs of
Annulment.</li>
</ul>
<p>All <a href="#crafting-instructions">Crafting Instructions</a> can be
used as currencies. This includes <a href="#currencies">Currency</a>
instructions of course, but also <a href="#harvest-crafting">Harvest
Crafts</a>, <a href="#beastcrafting">Beastcrafts</a>, <a
href="#betrayal-crafting">Betrayal Crafting</a>, and all operations from
the <a href="#crafting-bench">Crafting Bench</a>. For instance,
<code>1 harvest_augment_fire</code> is a valid amount.</p>
<h3 id="conditions">Conditions</h3>
<p>Conditions are expressions that can be used in <a
href="#if-conditionals">If Conditionals</a> and <a
href="#loops">Loops</a>. They are either built-in predicates,
comparisons of integral expressions (with the operators
<code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>,
<code>&gt;=</code>, <code>==</code>), negations, conjunctions or
disjunctions of subconditions (<code>not</code>, <code>and</code> or
<code>or</code>). Subconditions may contain side-effects, are evaluated
left to right, and have short-circuit evaluation (for instance, in
<code>a() == 0 || b() &gt; 0</code>, <code>a()</code> is evaluated first
and <code>b()</code> is not evaluated if <code>a() == 0</code>)
Examples:</p>
<ul>
<li><code>repeat chaos until has "LocalIncreasedPhysicalDamagePercent8" </code></li>
<li><code>if my_pdps_function() &gt; 400 or my_edps_function() &gt; 600 then gain 2 exalt</code></li>
</ul>
<h4 id="constants">Constants</h4>
<p>The following keywords are conditions expressions:</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>true</code></td>
<td>A condition which always holds</td>
</tr>
<tr class="even">
<td><code>false</code></td>
<td>A condition which never holds</td>
</tr>
</tbody>
</table>
<h4 id="boolean-operators">Boolean Operators</h4>
<p>The following operators can be used to combine conditions:</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Usage</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>not</code></td>
<td><code>not &lt;condition&gt;</code></td>
<td>Negate a condition</td>
</tr>
<tr class="even">
<td><code>and</code></td>
<td><code>&lt;condition&gt; and &lt;condition&gt;</code></td>
<td>Conjunction of two conditions: holds if both conditions hold</td>
</tr>
<tr class="odd">
<td><code>or</code></td>
<td><code>&lt;condition&gt; or &lt;condition&gt;</code></td>
<td>Disjunction of two conditions: holds if at least one of the two
conditions hold</td>
</tr>
</tbody>
</table>
<h4 id="parentheses">Parentheses</h4>
<p><code>not</code> has higher precedence than <code>and</code>, which
has higher precedence than <code>or</code>. What this means is that the
following expression:</p>
<div class="sourceCode" id="cb62"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="ex">not</span> open_suffix or no_prefix and full_prefixes</span></code></pre></div>
<p>Is equivalent to:</p>
<div class="sourceCode" id="cb63"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="kw">((</span><span class="ex">not</span> open_suffix<span class="kw">)</span> <span class="ex">or</span> <span class="er">(</span><span class="ex">no_prefix</span> and full_prefixes<span class="kw">))</span></span></code></pre></div>
<p>Parentheses <code>( ... )</code> can be used around any condition. If
operator precedence does not result in what you want, use parentheses.
For instance:</p>
<div class="sourceCode" id="cb64"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="ex">not</span> <span class="er">(</span><span class="kw">(</span><span class="ex">open_suffix</span> or no_prefix<span class="kw">)</span> <span class="ex">and</span> full_prefixes<span class="kw">)</span></span></code></pre></div>
<p>gives a completely different meaning to the expression. If you don't
understand precedence, just use parentheses everywhere!</p>
<h4 id="predicates-on-current-item">Predicates on Current Item</h4>
<p>The following expressions are conditions that hold depending on the
current item.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Usage</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>has</code></td>
<td><code>has &lt;identifier&gt;</code></td>
<td>Holds if the item has the modifier denoted by the given
identifier.</td>
</tr>
<tr class="even">
<td><code>prefix_count</code></td>
<td><code>prefix_count &lt;number1&gt;..&lt;number2&gt;</code></td>
<td>Holds if the item has at least <code>&lt;number1&gt;</code> prefixes
and at most <code>&lt;number2&gt;</code> prefixes.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>prefix_count &lt;number&gt;</code></td>
<td>Holds if the item has exactly the given number of prefix modifiers.
Same as <code>prefix_count &lt;number&gt;..&lt;number&gt;</code>.</td>
</tr>
<tr class="even">
<td><code>no_prefix</code></td>
<td><code>no_prefix</code></td>
<td>Holds if the item has no prefixes. Same as
<code>prefix_count 0</code>.</td>
</tr>
<tr class="odd">
<td><code>open_prefix</code></td>
<td><code>open_prefix</code></td>
<td>Holds if the item has at least one open prefix. This is <em>not</em>
equivalent to <code>prefix_count 0..2</code> as it depends on the item's
rarity.</td>
</tr>
<tr class="even">
<td><code>full_prefixes</code></td>
<td><code>full_prefixes</code></td>
<td>Holds if the item cannot have more prefixes. This is <em>not</em>
equivalent to <code>prefix_count 3</code> as it depends on the item's
rarity.</td>
</tr>
<tr class="odd">
<td><code>suffix_count</code></td>
<td><code>suffix_count &lt;number1&gt;..&lt;number2&gt;</code></td>
<td>Holds if the item has at least <code>&lt;number1&gt;</code> suffixes
and at most <code>&lt;number2&gt;</code> suffixes.</td>
</tr>
<tr class="even">
<td></td>
<td><code>suffix_count &lt;number&gt;</code></td>
<td>Holds if the item has exactly the given number of suffix modifiers.
Same as <code>suffix_count &lt;number&gt;..&lt;number&gt;</code>.</td>
</tr>
<tr class="odd">
<td><code>no_suffix</code></td>
<td><code>no_suffix</code></td>
<td>Holds if the item has no suffixes. Same as
<code>suffix_count 0</code>.</td>
</tr>
<tr class="even">
<td><code>open_suffix</code></td>
<td><code>open_suffix</code></td>
<td>Holds if the item has at least one open suffix. This is <em>not</em>
equivalent to <code>suffix_count 0..2</code> as it depends on the item's
rarity.</td>
</tr>
<tr class="odd">
<td><code>full_suffixes</code></td>
<td><code>full_suffixes</code></td>
<td>Holds if the item cannot have more suffixes. This is <em>not</em>
equivalent to <code>suffix_count 3</code> as it depends on the item's
rarity.</td>
</tr>
</tbody>
</table>
<h3 id="integral-expressions">Integral expressions</h3>
<p>Integrals expressions are either number constants, variables,
function calls, or built-in queries. They can be parenthesized, summed,
multiplied, divided, or subtracted with the usual operators (
<code>()</code>, <code>+</code>, <code>*</code>, <code>/</code>,
<code>-</code>) with the usual precedence rules. Subexpressions may
contain side-effects and are evaluated left to right (for instance, in
<code>a() + b() * c()</code>, <code>a()</code> is evaluated first, then
<code>b()</code>, then <code>c()</code>). Examples:</p>
<ul>
<li><code>2 * 2</code>;</li>
<li><code>(my_variable + 2) * 3</code>;</li>
<li><code>getmax "local_minimum_added_physical_damage" - getmin "local_minimum_added_physical_damage"</code>.</li>
</ul>
<h4 id="variables">Variables</h4>
<p><code>&lt;name&gt; = &lt;integral-expression&gt;</code> assigns an
integer to a variable. Variables are global (except with respect to <a
href="function-invocation">function invocations</a>). Unassigned
variables evaluate to <code>0</code>.</p>
<h4 id="queries-on-current-item">Queries on current item</h4>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Usage</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>base</code></td>
<td><code>base &lt;identifier&gt;</code></td>
<td>Returns the value of the base item property
<code>&lt;identifier&gt;</code>. For instance, <code>base</code> can
retrieve the base damage of a weapon base with
<code>base "physical_damage_min"</code> or
<code>base "physical_damage_max"</code>.</td>
</tr>
<tr class="even">
<td><code>getmin</code></td>
<td><code>getmin &lt;identifier&gt;</code></td>
<td>Returns the total minimum value of the stat
<code>&lt;identifier&gt;</code> of all explicit mods of the item. For
instance, <code>getmin</code> can retrieve the sum of all minimum local
"#% increased physical damage" possible rolls of all explicit mods on
the item with <code>getmin "local_physical_damage_+%"</code>.</td>
</tr>
<tr class="odd">
<td><code>getmax</code></td>
<td><code>getmax &lt;identifier&gt;</code></td>
<td>Returns the total maximum value of the stat
<code>&lt;identifier&gt;</code> of all explicit mods of the item. It
works the same way as <code>getmin</code>.</td>
</tr>
</tbody>
</table>
<h3 id="functions">Functions</h3>
<h4 id="declaration">Declaration</h4>
<p><code>function &lt;name&gt; &lt;name-list&gt; = &lt;instruction&gt;</code>
(where <code>&lt;name-list&gt;</code> denotes a whitespace-separated
list of argument names) declares a function. Functions must be declared
before all other instructions of the recipe. Example:</p>
<pre><code>function min_physical_dps quality = {
  flat = getmin &quot;local_minimum_added_physical_damage&quot;
    + getmin &quot;local_maximum_added_physical_damage&quot;
    + base &quot;physical_damage_min&quot;
    + base &quot;physical_damage_max&quot;
  attack_time = base &quot;attack_time&quot;
  increased_physical = 100 + quality + getmin &quot;local_physical_damage_+%&quot;
  increased_speed = 100 + getmin &quot;local_attack_speed_+%&quot;
  value = flat * increased_physical * increased_speed / (20 * attack_time)
  return value
}</code></pre>
<h4 id="function-invocation">Function invocation</h4>
<p><code>&lt;name&gt;(&lt;argument-list&gt;)</code> (where
<code>&lt;argument-list&gt;</code> denotes a comma-separated list of <a
href="integral-expressions">integral expressions</a>) calls a function.
This executes the function body in an environment where each argument
name listed in the function declaration is assigned to the corresponding
evaluated argument expression. The arguments are evaluated left to
right. Providing a number of arguments that doesn't match the number of
argument names listed in the function declaration is an error.</p>
<h4 id="return">Return</h4>
<p><code>return &lt;integral-expression&gt;</code> instructions may
appear in a function body.</p>
<p>The execution of the function body ends either when executing a
<code>return</code> expression or after the last instruction of the body
is executed, resuming the execution of the calling code. Once the
execution of a function ends, the function invocation evaluates to
either the integral-expression of the <code>return</code> instruction or
<code>0</code>.</p>
<p>Outside of a function body, <code>return</code> instructions behave
the same as evaluating their argument and calling <code>stop</code>.</p>
<h4 id="side-effects">Side-effects</h4>
<p>Functions can manipulate the item state (likewise, the imprint and
set-aside item) and may cause the evaluation of integral expressions and
conditions to have side-effects. In general, expressions are evaluated
left to right.</p>
<p>Except for the arguments passed to the function, variables are not
shared between the function body and the calling code. Modifying
arguments of the function has no effect on the calling code (they are
passed by copy).</p>
<p>Example:</p>
<pre><code>function chaos_spam_until_full_suffixes max_rolls = {
  counter = 0
  until counter &gt;= max_rolls or full_suffixes repeat {
    chaos
    counter = counter + 1
  }
  return counter
}

buy &quot;Metadata/Items/Amulets/Amulet7&quot;
max_rolls = 10
counter = 0
number_of_rolls = chaos_spam_until_full_suffixes(max_rolls)
echo max_rolls
echo number_of_rolls
echo counter</code></pre>
<p>will output</p>
<pre><code>10
&lt;some number between 0 and 10&gt;
0</code></pre>
<p>and the chaos-spammed item</p>
</body>
</html>
